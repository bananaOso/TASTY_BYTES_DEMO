fileVersion: 1
id: 0a1bd973-87d9-4c3e-a95a-0808ae1f9342
name: STG_CUSTOMER_METRICS
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: DW
  materializationType: table
  metadata:
    appliedNodeTests:
      - continueOnFailure: true
        description: ""
        name: Test
        runOrder: After
        templateString: "{{testUtils.expect_column_values_to_match_regex('PHONE_NUMBER','^\\d{3}-\\d{3}-\\d{4}$',isRaw=True)}}"
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7f6100c9-d02b-43d3-a27d-c26208dca4c7
          stepCounter: 0a1bd973-87d9-4c3e-a95a-0808ae1f9342
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        name: CITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cc0f037e-62da-41d5-b16f-7ec2fca0b707
                stepCounter: bc5a78ec-f129-4bdd-ae3b-f5eab4886a7c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4b000e8a-cadf-4274-8ed7-664072ae2952
          stepCounter: 0a1bd973-87d9-4c3e-a95a-0808ae1f9342
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: CUSTOMER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d551fa69-8128-4570-b988-49ea9e96938a
                stepCounter: bc5a78ec-f129-4bdd-ae3b-f5eab4886a7c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cbac9e94-42b7-4b4a-9f42-d2b3c9a1b70b
          stepCounter: 0a1bd973-87d9-4c3e-a95a-0808ae1f9342
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        name: COUNTRY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 65394060-9476-488f-8155-b91fb569c7cc
                stepCounter: bc5a78ec-f129-4bdd-ae3b-f5eab4886a7c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c4d9eabf-6a0d-4c29-8ffa-5ea98372d0e9
          stepCounter: 0a1bd973-87d9-4c3e-a95a-0808ae1f9342
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        name: FIRST_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f4adfa9b-744d-4d90-8927-3e413bd06b7d
                stepCounter: bc5a78ec-f129-4bdd-ae3b-f5eab4886a7c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e34dfef6-165b-4a1a-86e1-e295c3e26906
          stepCounter: 0a1bd973-87d9-4c3e-a95a-0808ae1f9342
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        name: LAST_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c58ff61c-e5eb-4e83-a03c-8a88a56c19fd
                stepCounter: bc5a78ec-f129-4bdd-ae3b-f5eab4886a7c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: de13c6d7-d6d8-4b7b-af37-08ca6fbaf66f
          stepCounter: 0a1bd973-87d9-4c3e-a95a-0808ae1f9342
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        name: PHONE_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 77937dd4-e402-4046-9746-0e15345491d1
                stepCounter: bc5a78ec-f129-4bdd-ae3b-f5eab4886a7c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3ddbad09-44f8-4e52-9d2b-dd0a69f4bbc4
          stepCounter: 0a1bd973-87d9-4c3e-a95a-0808ae1f9342
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        name: E_MAIL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2c4caf47-6fd7-4c2b-a33b-71eb3738b19f
                stepCounter: bc5a78ec-f129-4bdd-ae3b-f5eab4886a7c
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 569ec227-7d69-4dd7-9992-5b908ecb3b90
          stepCounter: 0a1bd973-87d9-4c3e-a95a-0808ae1f9342
        config: {}
        dataType: NUMBER(38,4)
        description: ""
        name: TOTAL_SALES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 929d2cec-28b4-402e-9ce8-707fca0ba97e
                stepCounter: d744f637-117e-4f66-9737-bb022ac06732
            transform: SUM("ORDER_HEADER"."ORDER_TOTAL")
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f102e584-42d4-48e1-b2ea-1589fa4a5ae8
          stepCounter: 0a1bd973-87d9-4c3e-a95a-0808ae1f9342
        config: {}
        dataType: ARRAY
        description: ""
        name: VISITED_LOCATION_IDS_ARRAY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 502f3623-75a7-4d45-bcf2-9bf42799eec4
                stepCounter: d744f637-117e-4f66-9737-bb022ac06732
            transform: ARRAY_AGG(DISTINCT "ORDER_HEADER"."LOCATION_ID")
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          ORDER_HEADER: d744f637-117e-4f66-9737-bb022ac06732
          STG_CUSTOMER_LOYALTY: bc5a78ec-f129-4bdd-ae3b-f5eab4886a7c
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DW
            nodeName: STG_CUSTOMER_LOYALTY
          - locationName: RAW_POS
            nodeName: ORDER_HEADER
        join:
          joinCondition: |-
            FROM {{ ref('DW', 'STG_CUSTOMER_LOYALTY') }} "STG_CUSTOMER_LOYALTY"
            INNER JOIN {{ ref('RAW_POS', 'ORDER_HEADER') }} "ORDER_HEADER"
            ON "STG_CUSTOMER_LOYALTY"."CUSTOMER_ID" = "ORDER_HEADER"."CUSTOMER_ID"
            GROUP BY ALL
        name: STG_CUSTOMER_METRICS
        noLinkRefs: []
  name: STG_CUSTOMER_METRICS
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
